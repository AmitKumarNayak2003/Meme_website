<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Random Meme Generator</title>
    <!-- We'll use Tailwind CSS for some quick and nice styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* A simple style for a smooth transition when the image changes */
        #memeImage {
            transition: opacity 0.5s ease-in-out;
        }
        .loading {
            opacity: 0.5;
        }
    </style>
</head>
<body class="bg-gray-900 text-white font-sans flex flex-col items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-2xl bg-gray-800 rounded-2xl shadow-2xl p-6 md:p-8 text-center">
        <h1 class="text-3xl md:text-4xl font-bold mb-2 text-cyan-400">Your Daily Dose of Memes</h1>
        <p class="text-gray-400 mb-6">A new meme will appear every 15 seconds. Enjoy!</p>

        <!-- This is where the meme will be displayed -->
        <div id="meme-container" class="bg-gray-900 rounded-lg p-4 min-h-[400px] flex items-center justify-center flex-col">
            <!-- The title of the meme will go here -->
            <h2 id="memeTitle" class="text-xl font-semibold mb-4 h-12">Loading a fresh meme...</h2>
            <!-- The meme image will be loaded into this img tag -->
            <img id="memeImage" src="https://placehold.co/600x400/111827/38bdf8?text=Loading..." alt="Random Meme" class="max-w-full max-h-[60vh] rounded-lg mx-auto">
        </div>
        
        <!-- A button to fetch a new meme manually -->
        <button id="newMemeBtn" class="mt-6 bg-cyan-500 hover:bg-cyan-600 text-white font-bold py-3 px-6 rounded-lg transition-transform transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-cyan-400 focus:ring-opacity-75">
            Get New Meme Now
        </button>
    </div>

    <script>
        // Get references to the HTML elements we need to interact with.
        const memeContainer = document.getElementById('meme-container');
        const memeImage = document.getElementById('memeImage');
        const memeTitle = document.getElementById('memeTitle');
        const newMemeBtn = document.getElementById('newMemeBtn');

        // This is the URL of our Python backend server.
        // Make sure the Python script is running for this to work.
        const BACKEND_URL = 'http://127.0.0.1:5000/get-meme';

        // This function fetches a new meme from our backend.
        // The 'async' keyword allows us to use 'await' for the network request.
        async function fetchNewMeme() {
            console.log('Fetching a new meme...');
            // Add a loading effect while we wait for the new image
            memeImage.classList.add('loading');
            memeTitle.textContent = 'Finding a great meme...';

            try {
                // Use the fetch API to make a request to our backend.
                const response = await fetch(BACKEND_URL);

                // Check if the response from the server is okay.
                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }

                // Parse the JSON data from the response.
                const data = await response.json();

                // Update the image source and title with the new meme data.
                memeImage.src = data.url;
                memeTitle.textContent = data.title;

            } catch (error) {
                // If something goes wrong, log the error and show a message to the user.
                console.error('Could not fetch meme:', error);
                memeTitle.textContent = 'Sorry, could not load a meme. :(';
                memeImage.src = 'https://placehold.co/600x400/111827/ef4444?text=Error!';
            } finally {
                // Remove the loading effect once the image has loaded (or failed).
                memeImage.onload = () => memeImage.classList.remove('loading');
                // Also remove it in case of an error where onload doesn't fire (e.g., broken image link)
                setTimeout(() => memeImage.classList.remove('loading'), 500);
            }
        }

        // --- Event Listeners and Timers ---

        // 1. Fetch a meme immediately when the page first loads.
        // We wrap it in DOMContentLoaded to make sure the HTML is fully loaded first.
        document.addEventListener('DOMContentLoaded', fetchNewMeme);

        // 2. Set an interval to automatically fetch a new meme every 15 seconds (15000 milliseconds).
        setInterval(fetchNewMeme, 15000);
        
        // 3. Add a click event listener to the button to fetch a meme manually.
        newMemeBtn.addEventListener('click', fetchNewMeme);

    </script>
</body>
</html>
